---
title: "JUSTICIA CON DATA"
subtitle: "Análisis de las resoluciones"
author: "[Sebastian Contreiras](https://ar.linkedin.com/in/sebastian-contreiras-92698627)"
date: "Noviembre de 2020"
output: 
  html_document:
    toc: yes
    toc_float: yes
    number_sections: yes
    # theme: united
    theme: flatly
---
```{r pressure, echo=FALSE, out.width = '100%'} 
knitr::include_graphics("banner.png")
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```


```{r Carga Librerias}
#Carga librerias y base recorridos.

library(tidyverse)
library(funModeling)
library(plotly)
library(treemapify)
library(glue)
library(scales)
library(RColorBrewer)
library(wordcloud)
library(wordcloud2) 
library(rpart)
library(rattle)

justicia <- readRDS('Data/justicia.rds')
```


El informe se realiza en el marco del desafío __"Analizando denuncias relacionadas a la violencia de género"__ propuesto por la [__Escuela de Datos Vivos__](https://escueladedatosvivos.ai/). 

Utiliza los datos proporcionados por el [__Juzgado Penal Contravencional y Faltas N° 10 de la Ciudad de Buenos Aires__](https://twitter.com/jpcyf10) sobre denuncias y casos relacionados con violencia de género.

El objetivo es poder analizar los casos y encontrar patrones para detectar los comportamientos más comúnmente denunciados.






# RESOLUCIONES

## Descripción y resumen inicial

Existe un marcado __aumento de la cantidad de resoluciones__ del Juzgado durante el período __2016-2019__.

El incremento de la resoluciones entre los extremos del período mencionado es del __568%__.

__2020__ es un año __atípico__ a partir de la pandemia de Covid-19 y las posteriores medidas adoptadas por el gobierno nacional en el marco del ASPO.



```{r Resoluciones al año}

g0 <- ggplot(justicia, aes(AÑO)) +
  geom_bar(fill='lightgreen') +
  labs(x = "Año", y = "Resoluciones", title="Resoluciones anuales - 2016-2020") +
  scale_y_continuous(n.breaks = 10)

ggplotly(g0)
```

Si analizamos la proporción de resoluciones año por año según la competencia del juzgado, se observa un __aumento progresivo__ y sostenido de la __materia penal__, pasando de un 43% del total de las resoluciones en 2016 al 73% en 2020.

__Comportamiento opuesto__ es el que presenta la __material Contravencional__, con una caída de 32 puntos porcentuales.




```{r Resoluciones al año según Materia}

jus1 <- justicia %>%
  filter(! is.na(MATERIA))

g1 <- ggplot(jus1, aes(AÑO, fill=MATERIA)) +
  geom_bar(position = 'fill') +
  labs(x = "Año", y = "% de Resoluciones", title="Resoluciones anuales según Materia - 2016-2020") +
  scale_fill_manual(values=brewer.pal(n = 7, name = "Set2")) +
  scale_y_continuous(labels=scales::percent)

ggplotly(g1)
```


Al explorar las conductas relativas a los hechos denunciados, las __amenazas__ representan el 17%.

Son destacables también conductas tales como:
* Conducir bajo efectos del alcohol o estupefacientes

* Incumplimientos de clausuras

* Hostigamiento

*	Material de abuso y explotación de menores (mesnna masnna)



```{r Wordcloud Conductas}

tabla_conducta <-freq(justicia$CONDUCTA)

tabla_conducta <- tabla_conducta %>%
  select(var, frequency)
# Basic plot
wordcloud2(data=tabla_conducta, size=1.6, color='random-light', backgroundColor="black")

```


## Violencia de Género

Las conductas imputadas se encuentran dentro de un contexto de __violencia de género__ en el __28% de los casos__.


```{r Violencia de Genero, fig.width=5, fig.height=3}
  viol_gen_porc <- justicia %>%
    select(VIOLENCIA_DE_GENERO) %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(VIOLENCIA_DE_GENERO) %>%
    summarise(Resoluciones=sum(RESOLUCIONES)) %>%
    filter(!is.na(VIOLENCIA_DE_GENERO)) %>%
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)  


  lab <- viol_gen_porc %>%
    glue_data('{round(Porcentaje,1)}% \n{VIOLENCIA_DE_GENERO}')
  
  ggplot(viol_gen_porc, aes(area = Porcentaje, fill = VIOLENCIA_DE_GENERO,
                     label = lab)) + geom_treemap() + 
    theme(legend.position="none") +
    geom_treemap_text(size = 16 , min.size = 1, colour = "white", place = "topleft")
```


## Tipos de violencia

Las declaraciones presentan variados índices de los tipos de violencia contemplados en los casos.

La violencia __psicológica__ y __simbólica__ aparecen en la gran __mayoría__ de los casos (91%).

__Más de la mitad__ de los casos presentan violencia __física__ (54%).

Es menor, aunque de importancia la presencia de violencia ecónomica y social (22% y 15% respectivamente).



```{r Tipos de Violencia, fig.width=2.5, fig.height=2.5}
violencia_fisica <- justicia %>%
    rename(Fisica=V_FISICA) %>%
    filter(Fisica=='Si' | Fisica=='No') %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(Fisica) %>%  
    summarise(Resoluciones=sum(RESOLUCIONES)) %>% 
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)

violencia_psicologica <- justicia %>%
    rename(Psicologica=V_PSIC) %>%
    filter(Psicologica=='Si' | Psicologica=='No') %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(Psicologica) %>%  
    summarise(Resoluciones=sum(RESOLUCIONES)) %>% 
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)

violencia_economica <- justicia %>%
    rename(Economica=V_ECON) %>%
    filter(Economica=='Si' | Economica=='No') %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(Economica) %>%  
    summarise(Resoluciones=sum(RESOLUCIONES)) %>% 
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)

violencia_sexual <- justicia %>%
    rename(Sexual=V_SEX) %>%
    filter(Sexual=='Si' | Sexual=='No') %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(Sexual) %>%  
    summarise(Resoluciones=sum(RESOLUCIONES)) %>% 
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)

violencia_social <- justicia %>%
    rename(Social=V_SOC) %>%
    filter(Social=='Si' | Social=='No') %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(Social) %>%  
    summarise(Resoluciones=sum(RESOLUCIONES)) %>% 
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)

violencia_ambiental <- justicia %>%
    rename(Ambiental=V_AMB) %>%
    filter(Ambiental=='Si' | Ambiental=='No') %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(Ambiental) %>%  
    summarise(Resoluciones=sum(RESOLUCIONES)) %>% 
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)

violencia_simbolica <- justicia %>%
    rename(Simbolica=V_SIMB) %>%
    filter(Simbolica=='Si' | Simbolica=='No') %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(Simbolica) %>%  
    summarise(Resoluciones=sum(RESOLUCIONES)) %>% 
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)


ggplot(violencia_fisica,mapping = aes(x=2,y=Porcentaje, fill=Fisica)) +
    geom_bar(stat = "identity", color="white") +
    geom_text(aes(label=percent(Porcentaje/100)),
              position=position_stack(vjust=0.5),color="white",size=4)+
  coord_polar(theta = "y") + 
      theme_void()+
    labs(title="Violencia Física")+
  xlim(0.8,2.5)

ggplot(violencia_psicologica,mapping = aes(x=2,y=Porcentaje, fill=Psicologica)) +
    geom_bar(stat = "identity", color="white") +
    geom_text(aes(label=percent(Porcentaje/100)),
              position=position_stack(vjust=0.5),color="white",size=4)+
  coord_polar(theta = "y") + 
      theme_void()+
    labs(title="Violencia Psicológica")+
  xlim(0.8,2.5)

ggplot(violencia_economica,mapping = aes(x=2,y=Porcentaje, fill=Economica)) +
    geom_bar(stat = "identity", color="white") +
    geom_text(aes(label=percent(Porcentaje/100)),
              position=position_stack(vjust=0.5),color="white",size=4)+
  coord_polar(theta = "y") + 
      theme_void()+
    labs(title="Violencia Económica")+
  xlim(0.8,2.5)

ggplot(violencia_sexual,mapping = aes(x=2,y=Porcentaje, fill=Sexual)) +
    geom_bar(stat = "identity", color="white") +
    geom_text(aes(label=percent(Porcentaje/100)),
              position=position_stack(vjust=0.5),color="white",size=4)+
  coord_polar(theta = "y") + 
      theme_void()+
    labs(title="Violencia Sexual")+
  xlim(0.8,2.5)

ggplot(violencia_social,mapping = aes(x=2,y=Porcentaje, fill=Social)) +
    geom_bar(stat = "identity", color="white") +
    geom_text(aes(label=percent(Porcentaje/100)),
              position=position_stack(vjust=0.5),color="white",size=4)+
  coord_polar(theta = "y") + 
      theme_void()+
    labs(title="Violencia Social")+
  xlim(0.8,2.5)

ggplot(violencia_ambiental,mapping = aes(x=2,y=Porcentaje, fill=Ambiental)) +
    geom_bar(stat = "identity", color="white") +
    geom_text(aes(label=percent(Porcentaje/100)),
              position=position_stack(vjust=0.5),color="white",size=4)+
  coord_polar(theta = "y") + 
      theme_void()+
    labs(title="Violencia Ambiental")+
  xlim(0.8,2.5)

ggplot(violencia_simbolica,mapping = aes(x=2,y=Porcentaje, fill=Simbolica)) +
    geom_bar(stat = "identity", color="white") +
    geom_text(aes(label=percent(Porcentaje/100)),
              position=position_stack(vjust=0.5),color="white",size=4)+
  coord_polar(theta = "y") + 
      theme_void()+
    labs(title="Violencia Simbólica")+
  xlim(0.8,2.5)

```

## Patrones de violencia

Analizando los distintos tipos de violencia que se presentan, podemos determinar __patrones de conducta__.

Para esto utilizamos un _análisis de cluster_. El modelo nos permite encontrar _similitudes_ y agrupar conductas mostrando patrones comunes.

Se observan tres grupos:

* Cluster 1: (Peso 22%) Utilización de violencia económica y sexual.

* Cluster 2: (Peso 34%) Utilización de violencia psicológica, social y simbólica.

* Cluster 3: (Peso 44%) Utilización de violencia física, psicológica, ambiental y simbólica.

Esto podría indicarnos que los acusados del primer cluster buscan ejercer una __dominación mediante el poder__, los del segundo cluster lo hacen a través de la __manipulación__ y los del tercer cluster se vuelcan más hacia __la violencia__.

```{r Cluster Violencia de Genero}
cluster_violencia <- readRDS('Data/cluster_violencia.rds')

cluster_violencia <- cluster_violencia %>%
  select(-VIOLENCIA_DE_GENERO)

## Análisis de resultados
coord_plot(data=cluster_violencia, 
           group_var="cluster", 
           group_func=mean, 
           print_table=FALSE)
```



## Semántica de la violencia

Un análisis más __cualitativo__ sobre la violencia que presentan los casos se observa en la transcripción de las frases descriptas por la víctima como la agresión verbal sufrida.

Se puede observar claramente el uso de un __lenguaje denigrante__ utilizado como __amenaza__ de muerte y lesiones.

Es claro el intento de imponer una __posición de poder y autoridad__ sobre la víctima.


```{r Wordcloud Frases}
tabla_frases <-freq(justicia$FRASES_AGRESION)

tabla_frases <- tabla_frases %>%
  select(var, frequency) %>%
  filter(!var=='no corresponde')
# Basic plot
# wordcloud2(data=tabla_frases, size=2)

wordcloud(tabla_frases$var , tabla_frases$frequency,
          colors=brewer.pal(8,"Set1"),random.order=FALSE)

```


# PERFIL DEL ACUSADO

__Ocho de cada diez__ acusados son __hombres argentinos__.

El 55% tiene un nivel de __instrucción secundaria__ (tanto incompleta, en curso o finalizada). Si abrimos un poco más al análisis, podemos ver que __3 de cada 4 acusados tiene niveles básicos__ de instrucción.

Respecto de la edad, el perfil más habitual es entre los __25 y 34 años__, cinco puntos mayor entre los acusados masculinos. Si sumamos el tramo siguiente, vemos que el 60% de los acusados se encuentran entre los __25 y 44 años__.


```{r Genero Acusado, fig.width=5, fig.height=3}
  gen_acus_porc <- justicia %>%
    select(GENERO_ACUSADO.A) %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(GENERO_ACUSADO.A) %>%
    summarise(Resoluciones=sum(RESOLUCIONES)) %>%
    filter(!GENERO_ACUSADO.A=='No Corresponde') %>%
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)  


  lab2 <- gen_acus_porc %>%
    glue_data('{round(Porcentaje,1)}% \n{GENERO_ACUSADO.A}')
  
  ggplot(gen_acus_porc, aes(area = Porcentaje, fill = GENERO_ACUSADO.A,
                     label = lab2)) + geom_treemap() + 
    theme(legend.position="none") +
    geom_treemap_text(size = 16 , min.size = 1, colour = "white", place = "topleft")
```


```{r Nacionalidad Acusado, fig.width=5, fig.height=3}
  nac_acus_porc <- justicia %>%
    select(NACIONALIDAD_ACUSADO.A) %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(NACIONALIDAD_ACUSADO.A) %>%
    summarise(Resoluciones=sum(RESOLUCIONES)) %>%
    filter(!NACIONALIDAD_ACUSADO.A=='No Corresponde') %>%
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)  


  lab4 <- nac_acus_porc %>%
    glue_data('{round(Porcentaje,1)}% \n{NACIONALIDAD_ACUSADO.A}')
  
  ggplot(nac_acus_porc, aes(area = Porcentaje, fill = NACIONALIDAD_ACUSADO.A,
                     label = lab4)) + geom_treemap() + 
    theme(legend.position="none") +
    geom_treemap_text(size = 16 , min.size = 1, colour = "white", place = "topleft")
```



```{r Nivel Educativo Acusado, fig.width=5, fig.height=3}
  educ_acus_porc <- justicia %>%
    select(NIVEL_INSTRUCCION_ACUSADO.A) %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(NIVEL_INSTRUCCION_ACUSADO.A) %>%
    summarise(Resoluciones=sum(RESOLUCIONES)) %>%
    filter(!NIVEL_INSTRUCCION_ACUSADO.A=='No Corresponde') %>%
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)  


  lab6 <- educ_acus_porc %>%
    glue_data('{round(Porcentaje,1)}% \n{NIVEL_INSTRUCCION_ACUSADO.A}')
  
  ggplot(educ_acus_porc, aes(area = Porcentaje, fill = NIVEL_INSTRUCCION_ACUSADO.A,
                     label = lab6)) + geom_treemap() + 
    theme(legend.position="none") +
    geom_treemap_text(size = 16 , min.size = 1, colour = "white", place = "topleft")
```


```{r Edad Acusados, fig.width=5, fig.height=3}
edad_acu <- justicia %>%
  filter(! is.na(EDAD_ACUSADO.A.AL.MOMENTO.DEL.HECHO)) %>%
  rename(Edad=`Edad Acusado`,Genero=GENERO_ACUSADO.A) %>%
  filter(Genero=='Masculino'|Genero=='Femenino')

# g3 <- ggplot(edad_acu,aes(Edad)) +
#     geom_freqpoly(color="#989bf3") +
#   scale_x_continuous(n.breaks = 10) +
#   scale_y_continuous(n.breaks = 10) + 
#       labs(x = "Edad", y = "Acusados", title="Edad de los Acusados")

g3 <- ggplot(edad_acu,aes(x=Genero, fill=Edad)) +
  geom_bar(position = 'Fill') +
  labs(x = "Género de los acusados", y = "Resoluciones") +
  scale_fill_manual(values=brewer.pal(n = 8, name = "Set2")) +
  scale_y_continuous(labels=scales::percent)

ggplotly(g3)

```





# PERFIL DEL DENUNCIANTE

Se observa claramente que el __denunciante es mujer__, y 8 de cada 10 son __argentinas__.

Los niveles de instrucción son __levementes mayores__ a los de los denunciados.

El nivel secundario asciende al 63% y el nivel terciario-universitario al 22%.

El __perfil étareo es levemente más joven__. Entre los 25 y 44 años, el porcentaje de denunciantes __asciende al 66%__, seis puntos por encima del perfil etáreo de los acusados. 



```{r Genero Denunciante, fig.width=5, fig.height=3}
  gen_denun_porc <- justicia %>%
    select(GENERO_DENUNCIANTE) %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(GENERO_DENUNCIANTE) %>%
    summarise(Resoluciones=sum(RESOLUCIONES)) %>%
    filter(!GENERO_DENUNCIANTE=='No Corresponde') %>%
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)  


  lab3 <- gen_denun_porc %>%
    glue_data('{round(Porcentaje,1)}% \n{GENERO_DENUNCIANTE}')
  
  ggplot(gen_denun_porc, aes(area = Porcentaje, fill = GENERO_DENUNCIANTE,
                     label = lab3)) + geom_treemap() + 
    theme(legend.position="none") +
    geom_treemap_text(size = 16 , min.size = 1, colour = "white", place = "topleft")
```



```{r Nacionalidad Denunciante, fig.width=5, fig.height=3}
  nac_denun_porc <- justicia %>%
    select(NACIONALIDAD_DENUNCIANTE) %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(NACIONALIDAD_DENUNCIANTE) %>%
    summarise(Resoluciones=sum(RESOLUCIONES)) %>%
    filter(!NACIONALIDAD_DENUNCIANTE=='No Corresponde') %>%
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)  


  lab5 <- nac_denun_porc %>%
    glue_data('{round(Porcentaje,1)}% \n{NACIONALIDAD_DENUNCIANTE}')
  
  ggplot(nac_denun_porc, aes(area = Porcentaje, fill = NACIONALIDAD_DENUNCIANTE,
                     label = lab5)) + geom_treemap() + 
    theme(legend.position="none") +
    geom_treemap_text(size = 16 , min.size = 1, colour = "white", place = "topleft")
```

```{r Nivel Educativo Denunciante, fig.width=5, fig.height=3}
  educ_den_porc <- justicia %>%
    select(NIVEL_INSTRUCCION_DENUNCIANTE) %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(NIVEL_INSTRUCCION_DENUNCIANTE) %>%
    summarise(Resoluciones=sum(RESOLUCIONES)) %>%
    filter(!NIVEL_INSTRUCCION_DENUNCIANTE=='No Corresponde') %>%
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)  


  lab7 <- educ_den_porc %>%
    glue_data('{round(Porcentaje,1)}% \n{NIVEL_INSTRUCCION_DENUNCIANTE}')
  
  ggplot(educ_den_porc, aes(area = Porcentaje, fill = NIVEL_INSTRUCCION_DENUNCIANTE,
                     label = lab7)) + geom_treemap() + 
    theme(legend.position="none") +
    geom_treemap_text(size = 16 , min.size = 1, colour = "white", place = "topleft")
```






```{r Edad Denunciantes, fig.width=5, fig.height=3}
edad_den <- justicia %>%
  filter(! is.na(EDAD_DENUNCIANTE_AL_MOMENTO_DEL_HECHO)) %>%
  rename(Edad=`Edad Denunciante`,Genero=`GENERO_DENUNCIANTE`,) %>%
  filter(Genero=='Masculino'|Genero=='Femenino')

g4 <- ggplot(edad_den,aes(x=Genero, fill=Edad)) +
  geom_bar(position = 'Fill') +
  labs(x = "Género de los denunciantes", y = "Resoluciones") +
  scale_fill_manual(values=brewer.pal(n = 9, name = "Set2")) +
  scale_y_continuous(labels=scales::percent)

ggplotly(g4)

```


# RELACIONES DE PARTES

## Género

La relación es casi en __exclusividad__ entre un __hombre acusado y una mujer denunciante__, algo que por lo expuesto anteriormente sólo confirma lo dicho.


```{r Relacion Generos}
rel_generos <- justicia %>%
  select(GENERO_ACUSADO.A,GENERO_DENUNCIANTE) %>%
  rename(Acusado = GENERO_ACUSADO.A,Denunciante = GENERO_DENUNCIANTE) %>%
  filter(! Acusado=='No Corresponde', !Denunciante=='No Corresponde') %>%
  count(Acusado, Denunciante)
  
  rel_generos$Acusado <-as.factor(rel_generos$Acusado)
  
  rel_generos$Denunciante <- as.factor(rel_generos$Denunciante)

g6 <- ggplot(rel_generos, aes(x = Acusado,y = Denunciante)) +
      geom_tile(aes(fill = n)) +
      theme(axis.text.x = element_text(angle = 20, hjust = 1)) +
      labs(x = "Género Acusado",
      y = "Género Denunciante")

ggplotly(g6)


```


## Nacionalidad

En general, la relación entre acusado y denunciante es __entre argentinos__.

Algo menor, pero para destacar es la relación entre sudamericanos.

Y también se observan relaciones entre acusado argentino y denunciante sudamericana y viceversa.

```{r Relacion Nacionalidades}
rel_nacionalidades <- justicia %>%
  select(NACIONALIDAD_ACUSADO.A,NACIONALIDAD_DENUNCIANTE) %>%
  rename(Acusado = NACIONALIDAD_ACUSADO.A,Denunciante = NACIONALIDAD_DENUNCIANTE) %>%
  filter(! Acusado=='No Corresponde', !Denunciante=='No Corresponde') %>%
  count(Acusado, Denunciante)
  
  rel_nacionalidades$Acusado <-as.factor(rel_nacionalidades$Acusado)
  
  rel_nacionalidades$Denunciante <- as.factor(rel_nacionalidades$Denunciante)

g7 <- ggplot(rel_nacionalidades, aes(x = Acusado,y = Denunciante)) +
      geom_tile(aes(fill = n)) +
      theme(axis.text.x = element_text(angle = 20, hjust = 1)) +
      labs(x = "Género Acusado",
      y = "Género Denunciante")

ggplotly(g7)


```


## Nivel de instrucción

La principal relación a nivel de instrucción se encuentra entre partes con __secundario incompleto o en curso__.

En general se observan __mayor cantidad de relaciones en niveles de instrucción bajo__, siendo escasa o nula en niveles de alta instrucción.

```{r Relacion Estudios}
rel_estudios <- justicia %>%
  select(NIVEL_INSTRUCCION_ACUSADO.A,NIVEL_INSTRUCCION_DENUNCIANTE) %>%
  rename(Acusado = NIVEL_INSTRUCCION_ACUSADO.A,Denunciante = NIVEL_INSTRUCCION_DENUNCIANTE) %>%
  filter(! Acusado=='No Corresponde', !Denunciante=='No Corresponde') %>%
  count(Acusado, Denunciante)
  
  rel_estudios$Acusado <-as.factor(rel_estudios$Acusado)
  
  rel_estudios$Denunciante <- as.factor(rel_estudios$Denunciante)

g8 <- ggplot(rel_estudios, aes(x = Acusado,y = Denunciante)) +
      geom_tile(aes(fill = n)) +
      theme(axis.text.x = element_text(angle = 20, hjust = 1)) +
      labs(x = "Acusado",
      y = "Denunciante")

ggplotly(g8)


```


## Edad

La edad media de los acusados es de 37 años, similar a la de las denunciantes, que se ubican en 36 años.

Se observan dos aspectos de importancia:

1. Si bien a medida que crece la edad de los acusados también lo hace la de las denunciantes, __es mayor el crecimiento de la edad__ de los primeros. Es decir, que por encima de la media de ambas partes, se encuentra a __acusados mayores a sus víctimas__ (_sector derecho de los cuadrantes_).

2. Sobre las medias de edad y por debajo de estas, la relación entre las edades es mucho más similar y pareja (_cuadrante inferior izquierdo_).



```{r Relacion Edades}
edades <- justicia %>%
  select(EDAD_ACUSADO.A.AL.MOMENTO.DEL.HECHO,EDAD_DENUNCIANTE_AL_MOMENTO_DEL_HECHO) %>%
  filter(EDAD_ACUSADO.A.AL.MOMENTO.DEL.HECHO>0,EDAD_DENUNCIANTE_AL_MOMENTO_DEL_HECHO>0) %>%
  rename(`EDAD ACUSADO`=EDAD_ACUSADO.A.AL.MOMENTO.DEL.HECHO,
         `EDAD DENUNCIANTE`=EDAD_DENUNCIANTE_AL_MOMENTO_DEL_HECHO)
  

g5 <- ggplot(edades, aes(x=`EDAD ACUSADO`, y=`EDAD DENUNCIANTE`)) +
  geom_point(aes()) +
  scale_x_continuous(n.breaks = 10) +
  scale_y_continuous(n.breaks = 10) +
  labs(x = "Edad del acusado",
       y = "Edad del denunciante") +
  geom_smooth(method = 'lm') +
  geom_hline(yintercept=mean(edades$`EDAD DENUNCIANTE`), color='#15921a') +
  geom_vline(xintercept=mean(edades$`EDAD ACUSADO`), color='#15921a')

ggplotly(g5)
```


# LOS HECHOS

## Relación entre las partes

__6 de cada 10 relaciones son entre ex-parejas__.

Si sumamos a las parejas que mantienen el vínculo, la proporción asciende a 8 de cada 10, describiendo una __problemática fuerte con raíces en un vínculo estrecho__.

Si bien es menor, es llamativo que el 12% de las relaciones estén establecidas entre partes sín vínculo primario (vecinos por ejemplo).


```{r Relación entre las partes, fig.width=5, fig.height=3}
  relaciones <- justicia %>%
    select(`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`) %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`) %>%
    summarise(Resoluciones=sum(RESOLUCIONES)) %>%
    filter(!`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`=='No Corresponde') %>%
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)  


  lab8 <- relaciones %>%
    glue_data('{round(Porcentaje,1)}% \n{`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`}')
  
  ggplot(relaciones, aes(area = Porcentaje, fill = `RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`,
                     label = lab8)) + geom_treemap() + 
    theme(legend.position="none") +
    geom_treemap_text(size = 16 , min.size = 1, colour = "white", place = "topleft")
```


## Frecuencia de los episodios

El 64% de los episodios tiene una __frecuencia habitual__, mientras que el 36% son sucesos esporádicos o se han dado por primera vez.

Es importante el peso que tiene la __relación de ex-pareja__ en las distintas frecuencias, siendo mucho __mayor en los sucesos habituales__, donde ocurre en el 72% de los hechos.


```{r Frecuencia de los episodios según Relacion entre las partes}

jus3 <- justicia %>%
  select(FRECUENCIA_EPISODIOS,`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`) %>%
  filter(! is.na(FRECUENCIA_EPISODIOS),! is.na(`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`),!`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`=="No Corresponde",!FRECUENCIA_EPISODIOS=="No Corresponde") %>%
  rename(Frecuencia=FRECUENCIA_EPISODIOS, Relacion=`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`)

g9 <- ggplot(jus3, aes(Frecuencia, fill=Relacion)) +
  geom_bar() +
  labs(x = "Frecuencia de los episodios", y = "Resoluciones", title="Relación de las partes según Frecuencia de los Episodios") +
  scale_fill_manual(values=brewer.pal(n = 9, name = "Set2"))


ggplotly(g9)
```


## Zona del hecho

La mitad de los hechos denunciados sucedieron en la __zona sur__ de la ciudad.


```{r Zona del hecho, fig.width=5, fig.height=3}
  zona <- justicia %>%
    select(ZONA_DEL_HECHO) %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(ZONA_DEL_HECHO) %>%
    summarise(Resoluciones=sum(RESOLUCIONES)) %>%
    filter(!ZONA_DEL_HECHO=='No Corresponde') %>%
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)  


  lab9 <- zona %>%
    glue_data('{round(Porcentaje,1)}% \n{ZONA_DEL_HECHO}')
  
  ggplot(zona, aes(area = Porcentaje, fill = ZONA_DEL_HECHO,
                     label = lab9)) + geom_treemap() + 
    theme(legend.position="none") +
    geom_treemap_text(size = 16 , min.size = 1, colour = "white", place = "topleft")
```

## Lugar de los episodios

Casi 6 de cada 10 hechos ocurren __exclusivamente en el domicilio del denunciado__. Si tomamos en cuenta los hechos donde además del domicilio ocurren en otros lugares, la cifra sube al 70%.

Los medios tecnológicos tienen una participación del 9%, pero en combinación con otros lugares, su proporción sube al 21%.

Pareciera que estos medios le dan al acusado la posibilidad de __complementar o reforzar sus actos__.

```{r Lugar del hecho, fig.width=5, fig.height=3}
  lugar <- justicia %>%
    select(LUGAR_DEL_HECHO) %>%
    mutate(RESOLUCIONES=1) %>%
    group_by(LUGAR_DEL_HECHO) %>%
    summarise(Resoluciones=sum(RESOLUCIONES)) %>%
    filter(!LUGAR_DEL_HECHO=='No Corresponde') %>%
    ungroup() %>% 
    mutate(Porcentaje=`Resoluciones`/sum(`Resoluciones`) * 100)  


  lab10 <- lugar %>%
    glue_data('{round(Porcentaje,1)}% \n{LUGAR_DEL_HECHO}')
  
  ggplot(lugar, aes(area = Porcentaje, fill = LUGAR_DEL_HECHO,
                     label = lab10)) + geom_treemap() + 
    theme(legend.position="none") +
    geom_treemap_text(size = 16 , min.size = 1, colour = "white", place = "topleft")
```


Finalmente si analizamos los lugares de los hechos según la relación entre acusado y denunciante, vemos que son sucesos generalmente __ocurridos en ámbitos privados__, sobre todo en los __vínculos más estrechos__ (ex-parejas y parejas constituídas).


```{r Relacion entre las partes según Lugar del Hecho}

jus4 <- justicia %>%
  select(`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`, LUGAR_DEL_HECHO) %>%
  filter(! is.na(LUGAR_DEL_HECHO),! is.na(`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`),!`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`=="No Corresponde",!LUGAR_DEL_HECHO=="No Corresponde") %>%
  rename(`Lugar del Hecho`=LUGAR_DEL_HECHO, Relacion=`RELACION_Y_TIPO_ENTRE_ACUSADO.A_Y_DENUNCIANTE`)

jus4 <- jus4 %>%
  filter(! Relacion=="Laboral", ! Relacion=="Otro vinculo")

g10 <- ggplot(jus4, aes(Relacion, fill=`Lugar del Hecho`)) +
  geom_bar() +
  labs(x = "Relación", y = "Resoluciones", title="Lugar de los Hechos según Relación de las partes") +
  scale_fill_manual(values=brewer.pal(n = 10, name = "Spectral")) +
  theme(axis.text.x = element_text(angle = 20, hjust = 1))


ggplotly(g10)
```



## Patrones de los hechos

Finalmente podemos determinar __patrones en los hechos denunciados__, utilizando nuevamente el análisis de cluster.

Delineamos tres grupos:

* Cluster 1: (Peso 15%) Materia Contravencional. Adultos mayores argentinos. Generalmente de baja instrucción o universitarios. Hechos en domicilio de frecuencia eventual. Zona este y oeste.

* Cluster 2: (Peso 52%) Materia Penal. Argentinos de edad media. Acusados de bajos estudios y denunciantes de nivel terciario. Hechos esporádicos, sin relación entre las partes, realizados en público o con medios tecnológicos (incluso combinando). Zona sur.

* Cluster 3: (Peso 33%) Materia Penal. Jóvenes extranjeros. Instrucción a nivel secundario. Hechos habituales a nivel familiar o de pareja (incluidas ex) con mayor uso de medios tecnológicos. Zona norte y sur.



```{r Cluster Relaciones}
cluster_relaciones <- readRDS('Data/cluster_relaciones.rds')

## Análisis de resultados
coord_plot(data=cluster_relaciones, 
           group_var="cluster", 
           group_func=mean, 
           print_table=FALSE)
```


## Clasificacion de la violencia de genero

Avanzando en el estudio de la violencia de género, se intenta _predecir si un caso tiene mayor probabilidad_ de ser incluído en esta definición a partir de las características del hecho.

Para eso se utiliza un modelo estadístico de _árboles de decisión_.

Este modelo toma como input la frecuencia y el lugar de los hechos junto a la relación entre partes. Y _predice la probabilidad_ de que sea un hecho de violencia de género.

Los segmentos de clasificación con mayor probabilidad son:

* Segmento 15 - Probabilidad: 58% (Peso: 11%)
   FRECUENCIA=Eventual,Habitual +
   LUGAR=Combinacion,Otros

* Segmento 29 - Probabilidad: 52% (Peso: 32%)
   FRECUENCIA=Eventual,Habitual +
   LUGAR=Domicilio +
   RELACION=Ex Pareja,Otras

* Segmento 28 - Probabilidad: 48% (Peso: 11%)
   FRECUENCIA=Eventual,Habitual +
   LUGAR=Domicilio +
   RELACION=Familiar,Pareja,Sin relacion

<!-- * Segmento 6 - Probabilidad: 41% (Peso: 16%) -->
<!--    FRECUENCIA=Eventual,Habitual - -->
<!--    LUGAR=Medios Tecnologicos,Via Publica -->

<!-- * Segmento 4 - Probabilidad: 45% (Peso: 16%) -->
<!--    FRECUENCIA=Esporadico -->

<!-- * Segmento 5 - Probabilidad: 47% (Peso: 13%) -->
<!--    FRECUENCIA=Primera Vez -->


```{r Decision Tree}
arbol_justicia <- readRDS('Data/cluster_justicia.rds')

## Modelo decision tree
fit_tree=rpart(data = arbol_justicia, 
                 formula = VIOLENCIA ~ FRECUENCIA + RELACION + LUGAR,
                 control =  rpart.control(
                   cp = 0.000001,
                   minbucket=90,
                   minsplit=90
                 )
)

fancyRpartPlot(fit_tree, caption = '', palettes = 'PuRd')

```


Podemos ver que los __hechos habituales__ que se suceden en __ámbitos privados__ tienen una __mayor probabilidad__ de ser encuadrados en un caso de violencia de género (segmento 7, prob.52%), mientras que si son en un ámbito público o mediante medios tecnológicos es algo menos probable (segmento 6, prob.41%).



# APELACIONES

Sólo el __8% de las resoluciones son apeladas__.

Si analizamos las apelaciones junto a las características de las resoluciones, podemos establecer patrones que midan la probabilidad de que una resolución sea apelada.

Utilizando nuevamente el método de _árboles de decisión_, vemos que las resoluciones que más probablemente _sean apeladas_ son las que:

* Segmento 127 - Probabilidad: 67% (Peso: 0%)
   MATERIA=Faltas,Habeas Corpus + 
   RELACION=Pareja,Sin relacion + 
   FRECUENCIA=Esporadico,Primera Vez + 
   LUGAR=Medios Tecnologicos,Otros

 
 



```{r Decision Tree Apelaciones}
arbol_justicia2 <- readRDS('Data/cluster_justicia.rds')
arbol_justicia2 <- arbol_justicia2 %>%
  mutate(VIOLENCIA = case_when(
    VIOLENCIA %in% "No" ~ "0",
    VIOLENCIA %in% "Si" ~ "1"
  )) %>%
  filter(APELA=="Si"|APELA=="No")


## Modelo decision tree
fit_tree=rpart(data = arbol_justicia2, 
               formula = APELA ~ MATERIA + VIOLENCIA + FRECUENCIA + RELACION + LUGAR,
               control =  rpart.control(
                 cp = 0.000001,
                 minbucket=3,
                 minsplit=3
               )
)

fancyRpartPlot(fit_tree, caption = '', palettes = 'PuRd')
```






# CONCLUSIONES

* En el marco de un __aumento exponencial__ de las resoluciones, hay un __crecimiento de las causas penales__ en detrimento de las contravencionales.

* 3 de cada 10 conductas imputadas se encuadran en __violencia de género__ y destaca que:

  + La violencia psicológica y simbólica aparecen en la gran mayoría de los casos (91%).
  + Más de la mitad de los casos presentan violencia física (54%).
  + Se observan tres patrones de conducta de los acusados: 
    - Dominación mediante el poder (violencia económica y sexual) 
    - Manipulación (psicológica, social y simbólica)
    - Imposición y violencia (violencia física, psicológica, ambiental y simbólica).
    
* En general, los acusados son hombres (80%) y las __denunciantes mujeres__ (casi el 100%) lo que indica la relación casi exclusiva entre las partes.

* En ambos partes, el __80% tiene niveles básicos de instrucción__ (hasta secundario completo). Las denunciantes poseen una composición educativa levemente más alta que la de los acusados.

* La principal relación a nivel de instrucción es entre __partes con secundario incompleto o en curso__, encontrándose mayor cantidad de relaciones en __niveles de instrucción bajo__, siendo escasa o nula en niveles de alta instrucción.

* Las denunciantes tienen un __perfil etáreo algo más joven__ que los acusados y se sitúa en general entre los __25 y 44 años__, con un promedio de edades entre los __36 y 37 años__.

* Por encima de la media de edad, __los acusados son mayores que sus víctimas__. Y sobre la media y por debajo de esta, la relación es mucho __más similar y pareja__.

* Hay una __problemática fuerte__ en los __vínculos más estrechos__. 6 de cada 10 relaciones entre las partes son __entre ex-parejas__ (8 de cada 10 si incluímos a las parejas).

* El 64% de los episodios ocurre __habitualmente__ y es alto el peso que tiene la relación de ex-pareja en ellos (72%).

* El __domicilio del denunciado__ es el lugar donde ocurren __más frecuentemente los hechos__ (70%). Los __medios tecnológicos__ tienen una participación del 21% pareciendo que dan la posibilidad al acusado de complementar o reforzar sus actos.

* Los hechos __habituales que se suceden en ámbitos privados__ tienen una __mayor probabilidad de ser encuadrados en un caso de violencia de género__ (52%), mientras que si son en un ámbito público o mediante medios tecnológicos es algo menos probable (41%).

* Finalmente se encuentran __patrones en los hechos denunciados__:

  + 15%: Materia Contravencional. Adultos mayores argentinos. Generalmente de baja instrucción o universitarios. Hechos en domicilio de frecuencia eventual. Zona este y oeste.

  + 52%: Materia Penal. Argentinos de edad media. Acusados de bajos estudios y denunciantes de nivel terciario. Hechos esporádicos, sin relación entre las partes, realizados en público o con medios tecnológicos (incluso combinando). Zona sur.

  + 33%: Materia Penal. Jóvenes extranjeros. Instrucción a nivel secundario. Hechos habituales a nivel familiar o de pareja (incluidas ex) con mayor uso de medios tecnológicos. Zona norte y sur.